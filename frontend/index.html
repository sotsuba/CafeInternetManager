<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SafeSchool - Cyber Monitor</title>
    <!-- New Styles -->
    <link rel="stylesheet" href="/src/styles/theme.css" />
    <link rel="stylesheet" href="/src/styles/layout.css" />
    <!-- Global font (optional, using system mono for now) -->
</head>
<body>
    <div class="app-container">

      <!-- 1. Sidebar -->
      <aside class="app-sidebar">
        <h1>Process<span class="text-primary">Guard</span></h1>
        <div class="client-list" id="client-list">
          <!-- JS will populate client items here -->
          <div class="p-4 text-muted text-sm">Waiting for connection...</div>
        </div>
        <div class="mt-auto pt-4 border-t border-border">
          <div class="text-xs text-muted">Team: CyberOps</div>
          <div class="text-xs text-muted">Topic: Safe Lab Management</div>
        </div>
      </aside>

      <!-- 2. Header -->
      <header class="app-header glass">
        <div class="flex items-center gap-2">
          <span class="text-muted">Home</span>
          <span class="text-muted">/</span>
          <span id="header-client-name" class="font-bold text-foreground">Overview</span>
        </div>
        <div class="flex gap-2">
          <button class="btn btn-sm" id="btn-theme-toggle" title="Toggle Dark/Light Mode">üåô</button>
        </div>
      </header>

      <!-- 3. Main Dashboard -->
      <main class="app-main" id="main-content">
        <!-- Default "Home" View -->
        <div id="view-home" class="flex flex-col items-center justify-center h-full text-muted" style="display: flex; height: 100%; align-items: center; justify-content: center;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üñ•Ô∏è</div>
            <p>Select a client from the sidebar to manage.</p>
        </div>

        <!-- Detailed Client Controller View (Hidden by default) -->
        <div id="view-client" class="dashboard-grid" style="display: none;">

          <!-- Live Monitor Widget -->
          <div class="widget-card glow-cyan">
            <div class="widget-header">
              <span class="widget-title">üì∫ Live Monitor</span>
              <div class="flex gap-2">
                <button class="btn btn-sm" id="btn-stream-screen">Start Stream</button>
                <button class="btn btn-sm" id="btn-record-screen">Rec (10s)</button>
                <button class="btn btn-sm" id="btn-fullscreen-screen">‚õ∂</button>
              </div>
            </div>
            <div class="video-wrapper scanlines">
              <video id="monitor-video" autoplay muted></video>
            </div>
          </div>

          <!-- Webcam Widget -->
          <div class="widget-card glow-green">
            <div class="widget-header">
              <span class="widget-title">üì∏ Surveillance</span>
              <div class="flex gap-2">
                <button class="btn btn-sm" id="btn-stream-webcam">Start Cam</button>
                <button class="btn btn-sm" id="btn-record-webcam">Rec (10s)</button>
                <button class="btn btn-sm" id="btn-fullscreen-webcam">‚õ∂</button>
              </div>
            </div>
            <div class="video-wrapper">
              <video id="webcam-video" autoplay muted></video>
            </div>
          </div>

          <!-- Application Manager Widget -->
          <div class="widget-card" style="grid-column: span 2;">
            <div class="widget-header">
                <div class="flex items-center gap-2">
                    <span class="widget-title">üöÄ Application Launcher</span>
                    <input type="text" id="inp-search-apps" placeholder="Search Apps..." class="p-1 text-sm bg-black border border-white/20 rounded max-w-[150px]">
                    <div class="flex gap-1 ml-4">
                        <button class="btn btn-sm text-black" style="background-color: var(--neon-cyan);" id="btn-launch-selected">üöÄ Launch Selected</button>
                        <button class="btn btn-sm btn-destructive" id="btn-kill-selected">üíÄ Kill Selected</button>
                    </div>
                </div>
            </div>
            <div style="max-height: 400px; overflow-y: auto;">
              <table class="task-table">
                <thead>
                  <tr>
                    <th style="width: 40px;"><input type="checkbox" id="chk-select-all-apps"></th>
                    <th style="text-align: left;">Application</th>
                    <th style="width: 100px;">Status</th>
                    <th style="width: 120px; text-align: right;">Actions</th>
                  </tr>
                </thead>
                <tbody id="app-list-body">
                  <!-- App rows rendered here -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Process Manager Widget -->
          <div class="widget-card" style="grid-column: span 2;">
            <div class="widget-header">
              <span class="widget-title">‚ö° Process Manager</span>
              <div class="flex gap-2">
                  <div class="flex gap-1">
                      <input type="text" class="input input-sm" style="width: 150px;" placeholder="Start cmd explicitly..." id="inp-start-proc">
                      <button class="btn btn-sm" id="btn-start-proc-exec">Start</button>
                  </div>
                  <div style="position: relative;">
                    <input type="text" class="input input-sm" style="width: 150px; padding-right: 30px;" placeholder="Search process..." id="inp-search-proc">
                    <button id="btn-clear-search" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--muted-foreground); cursor: pointer; display: none;">‚úï</button>
                  </div>
              </div>
            </div>
            <div style="max-height: 200px; overflow-y: auto;">
              <table class="task-table">
                <thead>
                  <tr>
                    <th><input type="checkbox" id="chk-select-all-procs"></th>
                    <th>PID</th>
                    <th>Name</th>
                    <th>User</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="process-list-body">
                  <!-- JS populates rows -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Security Panel -->
          <div class="widget-card" style="grid-column: span 2;">
            <div class="widget-header">
              <span class="widget-title">üõ°Ô∏è Security Ops</span>
            </div>
            <div style="display: flex; gap: 1rem; align-items: center;">
              <button class="btn btn-destructive" id="btn-kill">üíÄ Kill Selected</button>
              <button class="btn btn-destructive" id="btn-restart" style="background-color: var(--neon-yellow); color: black;">üîÑ Restart Client</button>
              <button class="btn btn-destructive" id="btn-shutdown">üõë Shutdown Client</button>
            </div>
            <!-- Keylogger (Placeholder) -->
            <div style="margin-top: 1rem; border-top: 1px solid var(--border); padding-top: 1rem;">
                <div class="widget-header" style="margin-bottom: 0.5rem;">
                    <div class="flex items-center gap-2">
                        <span class="widget-title">‚å®Ô∏è Keylogger</span>
                        <span id="keylog-status" class="text-xs text-muted">Not started</span>
                    </div>
                    <div class="flex gap-2">
                         <button class="btn btn-sm" id="btn-keylog-download" disabled>Download</button>
                         <button class="btn btn-sm" id="btn-keylog-toggle">Enable Keylogger</button>
                    </div>
                </div>
                <div id="keylog-feed" class="keylog-feed"></div>
            </div>
          </div>

        </div>
      </main>

      <!-- 4. Footer -->
      <footer class="app-footer">
        <span id="status-connection" class="text-primary" style="color: var(--primary);">‚óè Connected</span>
        <span id="status-latency" style="margin-left: 1rem;">Ping: --ms</span>
        <span style="flex: 1;"></span>
        <span id="status-message">Ready.</span>
      </footer>

    </div>
    <script type="module" src="/src/main.ts"></script>
</body>
</html>
